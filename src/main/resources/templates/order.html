<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>発注数計算</title>

<style>
	/* 発注数が0の行をグレーアウト */
	.inactive{
		color: #999;
	}
</style>

</head>
<body>
	
<h2>発注数計算</h2>
<p th:text="'施設：' + ${facilityName}">施設名</p>

<form th:action="@{/order/calculate}" method="post">

	<table border="1">
		<tr>
			<th>製品名</th>
			<th>現在庫数</th>
			<th>次回納品数(自動)</th>
			<th>基準在庫(定数)</th>
			<th>発注数</th>
		</tr>
		
		<tr th:each="f, stat : ${facilityLinens}"
		    th:classappend="${orderQuantities != null and orderQuantities[stat.index] == 0} ? 'inactive' : ''">

			<!-- アイテム名 -->
			<td th:text="${f.linenItem.name}">アイテム</td>
			
			<!-- 現在在庫数:ユーザー入力 -->
			<td>
				<input type="number"
				       name="currentStock" 
					   min="0" 
					   required 
					   th:value="${currentStocks != null ? currentStocks[stat.index] : ''}">
					   
			</td>
			
			<!-- 次回納品数:自動入力(前回発注数の半数)編集可能 -->
			<td>
				<input type="number" 
			           name="nextDelivery"
					   min="0"
				       th:value="${nextDeliveries != null ? nextDeliveries[stat.index] : 0}">
			</td>
			
			<!-- 基準在庫(定数):表示のみ-->
			<td>
				<span class="readonly-box"  th:text="${f.baseStock}" >100</span>
				<!-- 計算用にhiddenで送る -->
				<input type="hidden" 
				       name="baseStock" 
					   th:value="${baseStockList != null ? baseStockList[stat.index] : f.baseStock}">
			</td>
			
			<!-- 発注数表示(indexで対応) -->
			<td>
				<span th:if="${orderQuantities != null}"
				      th:text="${orderQuantities[stat.index]}">0</span>
			</td>
			
		</tr>
</table>
	
<br>
<button type="submit">一括計算</button>
</form>

<!-- ★計算後だけ「確定」ボタンを表示(/order/confirmにPOST)-->
<div th:if="${orderQuantities != null}">
	<br>
	
	<form th:action="@{/order/confirm}" method="post">
		
		<input type="hidden" name="facilityId" th:value="${facilityId}">
		
		<div th:each="f, stat : ${facilityLinens}">
			<input type="hidden" name="facilityLinenId" th:value="${f.id}">
			<input type="hidden" name="currentStock" th:value="${currentStocks[stat.index]}">
			<input type="hidden" name="nextDelivery" th:value="${nextDeliveries[stat.index]}">
			<input type="hidden" name="baseStock" th:value="${baseStockList[stat.index]}">
			<input type="hidden" name="orderQuantity" th:value="${orderQuantities[stat.index]}">
		</div>
		
		<button type="submit">確定（DBに保存）</button>
	</form>
</div>

<br>
<a href="/dashboard">ダッシュボードへ戻る</a>
&nbsp;|&nbsp;
<a href="/facility/settings">基準在庫(定数)設定へ</a>

</body>
</html>